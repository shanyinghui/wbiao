<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>万表网</title>
    <link rel="stylesheet" href="http://127.0.0.1:10004/css/reset.css">
    <link rel="stylesheet" href="http://127.0.0.1:10004/css/self.css">
    <link rel="stylesheet" href="http://127.0.0.1:10004/css/shopping-order.css">
</head>
<body>
<!-- top -->
<div id="app">
    <div class="top">
        <div class="top-words container clearfix">
            <!-- top 左 -->
            <div class="top-left fl">
                <a href="index.html">正品保障，免息分期！</a>
            </div>
            <!-- top 右 -->
            <div class="top-right fr clearfix">
                <!-- 右 登录 -->
                <div v-if="flag">
                    <div class="top-login fl clearfix">
                        <a href="login.html">您好！&nbsp; {{user.username}}</a>
                        <a href='javascript:void(0)' @click='logout'>退出</a>
                    </div>
                    <!-- 右 其他 -->
                    <div class="top-others fl clearfix">
                        <span class="line fl">|</span>
                        <a href="vip/order.html">我的订单</a>
                    </div>
                </div>
                <div v-else>
                    <div class="top-login fl clearfix" >
                        <a href="http://www.wbiao.com/userPage/login.html">请登录</a>
                        <a href="http://www.wbiao.com/userPage/register.html">注册</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--头部-->
    <div class="pt-head">
        <div class="container">
            <!--左头部-->
            <div class="head-left fl">
                <!--logo-->
                <div class="logo">
                    <a href="http://www.wbiao.com/search.html" class="inline-block">
                        <img class="middle" src="http://127.0.0.1:10004/img/LOGO.png"/>
                    </a>
                    <a href="http://www.wbiao.com/search.html">
                        <img class="middle" src="http://127.0.0.1:10004/img/ia_200000007.png" alt="">
                    </a>
                </div>
            </div>
            <!--右头部-->
            <div class="head-right fr">
                <ul class="shop">
                    <li class="fl ">
                        <i class="icon-00"></i>
                        <span>购物车</span>
                    </li>
                    <li class="fl on">
                        <i class="icon-01"></i>
                        <span>填写订单信息</span>
                    </li>
                    <li class="fl">
                        <i class="icon-02"></i>
                        <span>支付订单</span>
                    </li>
                    <li class="fl">
                        <i class="icon-03"></i>
                        <span>等待签收</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--内容-->
    <div class="main">
        <div class="container">
            <!--收货人信息-->
            <div class="order-floor clearfix">
                <!--图标-->
                <span class="point fl">
                <i></i>
            </span>
                <!--信息-->
                <div class="floor fl">
                    <p class="title">
                        收货人信息
                        <a href="vip/order-address.html">管理收货地址</a>
                    </p>
                    <ul class="cont-box clearfix">
                        <!--现在的收货地址-->
                        <li v-for="(ads,index) in address" :class="ads.isActive?'on on1':'on on2'"  @click="active(index)">
                            <p class="p1">
                                <span class="name">{{ads.name}}</span>
                                <span class="phone">{{ads.phone}}</span>
                                <i class="is" v-if="ads.send_status == 1">默认</i>
                            </p>
                            <div class="address clearfix">
                            <span class="location fl">
                                <i class="icon-bd icon-loca "></i>
                            </span>
                                <p class="p3 fl">
                                    <span>{{ads.province}} {{ads.city}} {{ads.region}}</span>
                                </p>
                                <p class="p4 fl">
                                    <span>{{ads.detail_address}} </span>
                                </p>
                            </div>
                            <i class="icon-bd icon-arrow"></i>
                        </li>
                        <!--添加收获地址-->
                        <li class="add">
                            <a href="#">
                                <em>
                                    <i class="middle icon-bd icon-add"></i>
                                    添加收获地址
                                </em>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!--送货清单-->
            <div class="delivery-list clearfix">
                <!--图标-->
                <span class="point fl">
                    <i></i>
                </span>
                <p class="title">
                    送货清单 <span> (1) </span>
                    <a href="shopping.html">返回购物车修改</a>
                </p>
                <!--商品列表-->
                <div class="goods-list">
                    <!--商家 商品-->
                    <div class="shop-floor" v-for="cart in carts">
                        <!--商品头部-->
                        <div class="top clearfix">
                            <a href="#">万表商城 </a>
                        </div>
                        <!--商品信息-->
                        <div class="goods-floor clearfix">
                            <div class="photo fl">
                                <img :src="cart.image" alt="" style="width:85px">
                            </div>
                            <div class="info fl">
                                <p class="name">{{cart.title}}</p>
                                <p class="back">
                                    <span>7天退换</span>
                                </p>
                            </div>
                            <!--价格信息-->
                            <ul class="fr">
                                <!--单个价格-->
                                <li class="unit-price">￥<em>{{cart.price}}</em></li>
                                <!--数量-->
                                <li class="goods-num clearfix">
                                    <input type="text" :value="cart.num" readonly>
                                </li>
                                <!--多个的价格-->
                                <li class="all-price">￥<em>{{cart.money}}</em></li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
            <!--发票类型-->
            <div class="invoice-type">
                <!--图标-->
                <span class="point fl">
                <i></i>
            </span>
                <p class="title">
                    发票类型
                <div class="invoice">
                    <a href='javascript:void(0)'>电子发票</a>
                </div>
                </p>

            </div>
            <!--留言-->
            <div class="leaving">
                <!--图标-->
                <span class="point fl">
                <i></i>
            </span>
                <p class="title">
                    留言
                </p>
                <div class="leave">
                    <textarea class="txt" placeholder="请输入..."></textarea>
                </div>
            </div>
            <p class="price"> 商品总额 <span>￥ <em>{{totalMoney}}</em></span></p>
            <p class="freight"> 运费 <span>￥ <em>0</em></span></p>
            <!--底部提交-->
            <div class="bottom">
                <span class="pay">应付款 <em>￥<i>{{totalMoney}}</i></em></span>
                <span class="submit"> <a href="javascript:void(0)" @click="submit()">提交定单</a></span>
            </div>
        </div>
    </div>
</div>



<div class="shadow">
    <div class="information">
        <div class="title clearfix">
            <span class="title-left">添加收货地址</span>
            <span class="close fr">
                    <i href="#" class="icon-bd icon-close"></i>
            </span>

        </div>
        <!--填写内容-->
        <div class="data-block">
            <!--首行-->
            <div class="data-info clearfix">
                <!--收货人-->
                <div class="name fl">
                    <p class="dp vip-name">
                        (收货人)
                    </p>
                    <p class="input">
                        <input type="text" placeholder="请输入">
                        <i class="icon-bd icon-delete"></i>
                        <em class="error">
                            <i class="icon-bd icon-error"></i>
                            请填写收货人姓名
                        </em>
                    </p>
                </div>
                <!--手机号-->
                <div class="surname fl">
                    <p class="dp name-text">
                        (手机号)
                    </p>
                    <p class="input">
                        <input type="text" placeholder="请输入">
                        <i class="icon-bd icon-delete"></i>
                        <em class="error">
                            <i class="icon-bd icon-error"></i>
                            请填写手机号
                        </em>
                        <em class="tal-error">
                            <i class="icon-bd icon-error"></i>
                            手机号格式不正确
                        </em>
                    </p>
                </div>
            </div>
            <!--所在地-->
            <div class="location">
                <p class="dp">
                    (所在地区)
                </p>
                <!--下拉列表-->
                <select class="province" name="province3"></select>
                <select class="city" name="city3"></select>
                <select class="area" name="area3"></select>
            </div>
            <!--详细地址-->
            <div class="address-msg">
                <p class="dp  ">
                    (详细地址)
                </p>
                <p class="input">
                    <input type="text" placeholder="请输入">
                    <i class="icon-bd icon-delete"></i>
                    <em class="error">
                        <i class="icon-bd icon-error"></i>
                        请填写详细地址
                    </em>
                </p>
            </div>
            <!--默认-->
            <div class="sex">
                <!--单选框-->
                <div class="radio clearfix">
                    <p class="sex-btn fl">
                        <i class="default"></i>
                        <span class="icon-bd icon-circle middle"></span>
                        <em class="sex1" sex-code="1">设置默认</em>
                    </p>
                </div>
            </div>
        </div>
        <!--保存取消按钮-->
        <div class="layui-layer-btn clearfix">
            <a class="btn0 btn0-add fr">保存并使用</a>
            <a class="btn0 btn0-edit fr">保存并使用</a>
            <a class="btn1 fr">取消</a>
        </div>
        <!--表头-->

    </div>
</div>

<!-- footer -->
 <div class="footer">
    <div class="footer-top">
        <div class="container">
            <ul class="clearfix">
                <li class="fl">
                    <a href="javascript:;" class="clearfix">
                        <i class="icon_footer-top-1 fl"></i>
                        <div class="top-wodrs fl">正品保障</div>
                    </a>
                </li>
                <li class="fl">
                    <a href="javascript:;" class="clearfix">
                        <i class="icon_footer-top-2 fl"></i>
                        <div class="top-wodrs fl">免息分期</div>
                    </a>
                </li>
                <li class="fl">
                    <a href="javascript:;" class="clearfix">
                        <i class="icon_footer-top-3 fl"></i>
                        <div class="top-wodrs fl">全球联保</div>
                    </a>
                </li>
                <li class="fl">
                    <a href="javascript:;" class="clearfix">
                        <i class="icon_footer-top-4 fl"></i>
                        <div class="top-wodrs fl">假一赔三</div>
                    </a>
                </li>
                <li class="fl">
                    <a href="javascript:;" class="clearfix">
                        <i class="icon_footer-top-5 fl"></i>
                        <div class="top-wodrs fl">终身售后</div>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="footer-mid">
        <div class="container">
            <div class="mid-top clearfix">
                <div class="phone-num fl">
                    <div class="phone-words">客服电话</div>
                    <div class="phone-num1">400-883-2688</div>
                    <div class="phone-num2">外呼电话 020-83931899</div>
                    <a class="phone-btn">售后维修</a>
                </div>
                <div class="content fl">
                    <ul class="clearfix">
                        <li class="fl">
                            <dl>
                                <dt>新手指南</dt>
                                <dd>
                                    <a href="register.html">注册新会员</a>
                                    <a href="javascript:;">购物流程</a>
                                    <a href="javascript:;">手表小知识</a>
                                    <a href="javascript:;">退换货流程</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="fl">
                            <dl>
                                <dt>支 付</dt>
                                <dd>
                                    <a href="javascript:;">支付方式</a>
                                    <a href="javascript:;">分期付款</a>
                                    <a href="javascript:;">发票说明</a>
                                    <a href="javascript:;">支付问题</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="fl">
                            <dl>
                                <dt>配 送</dt>
                                <dd>
                                    <a href="javascript:;">包裹签收</a>
                                    <a href="javascript:;">配送方式</a>
                                    <a href="javascript:;">配送说明</a>
                                    <a href="javascript:;">自提流程</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="fl">
                            <dl>
                                <dt>万表保障</dt>
                                <dd>
                                    <a href="javascript:;">正品保障</a>
                                    <a href="javascript:;">售后服务</a>
                                    <a href="javascript:;">价格保护</a>
                                    <a href="javascript:;">七天退换说明</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="fl">
                            <dl>
                                <dt class="color">开放合作</dt>
                                <dd>
                                    <a href="javascript:;">关于万表</a>
                                    <a class="color" href="#">商务合作</a>
                                    <a href="javascript:;">万表声明</a>
                                </dd>
                            </dl>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mid-bottom">
                <div class="corp">
                    <ul>
                        <li>万表网名表商城 版权所有 2009-2019 <a href="#">ICP备案证书号:粤ICP备09108738号</a> 网监备案:4401060103141</li>
                        <li>广州市万表科技股份有限公司 地址:广州市番禺区番禺大道北60-1号</li>
                        <li>Copyright 2009-2019 WWW.WBIAO.CN.LTD ALL RIGHT RESERVED.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="http://127.0.0.1:10004/js/jquery-3.4.1.min.js"></script>
<script src="http://127.0.0.1:10004/js/PCASClass.js"></script>
<script src="http://127.0.0.1:10004/js/layer/layer.js"></script>
<script src="http://127.0.0.1:10004/js/vue.js"></script>
<script src="http://127.0.0.1:10004/js/axios.min.js"></script>
<script>
    $(document).ready(function() {
        //一个商店有两个商品的时候加入一个边框
        var $goods = $('.delivery-list .goods-list .shop-floor .goods-floor');
        if ($goods.length > 1) {
            for (var i = 1; i <= $goods.length; i++) {
                $goods.eq(i).css({
                    borderTop: '1px solid #eee',
                });
            }
        }



        //    input点击
        $(".head-search input").click(function () {
            $(this).parent('label').siblings('.srh-hot').show();
        });
        //    input里面的内容改变时
        $('.head-search input').on('input propertychange', function () {
            $(this).siblings('span').hide();
            $(this).parent('label').siblings('.srh-hot').hide();
            if ($(this).val() == '') {
                $(this).siblings('span').show();
                $(this).parent('label').siblings('.srh-hot').show();
            }
        });
        //    input 失去焦点的时候
        $(".head-search input").blur(function () {
            $(this).parent('label').siblings('.srh-hot').hide();
        });

        //  添加事件
        $('.order-floor .floor .cont-box .add').click(function () {
            $('.shadow .information .btn0-add').show();
            $('.shadow .information .btn0-edit').hide();
            $('.information').stop(true).show(100, function () {
                $(this).stop(true).animate({
                    width: 780,
                    height: 512,
                    marginLeft: -390,
                    marginTop: -256,
                }, 100);
            });
            $('.shadow').stop(true).fadeIn(100);
        });



        //    关闭按钮
        $('.shadow .title .icon-close ').click(function () {
            $('.shadow .information .btn1').click();
        });
        //    修改资料输入框
        $('.shadow .data-info input').on('input propertychange', function () {
            $(this).siblings('.icon-delete').show();
            if ($(this).val() == '') {
                $(this).siblings('.icon-delete').hide();
            }
        });
        //    修改资料输入框的 清除
        $('.shadow .data-info .icon-delete').click(function () {
            $(this).siblings('input').val('');
            $(this).hide();
        });
        //     默认
        $('.shadow .data-block .sex .sex-btn').click(function () {
            var flag = $(this).find('.default').is(':visible');
            if (flag) {
                $(this).find('.icon-circle').css({visibility: 'visible'});
                $(this).find('.default').hide();

            } else {
                $(this).find('.icon-circle').css({visibility: 'hidden'});
                $(this).find('.default').show();
            }
        });
        //    省市选择下拉显示
        $('.shadow .data-block .location .province').change(function () {
            $(this).siblings('.city').show();
            $(this).siblings('.area').show();
            var txt = $(this).val();
            if (txt == '') {
                $(this).siblings('.city').hide();
                $(this).siblings('.area').hide();
            }
        });
        //  取消重置按钮
        $('.shadow .information .btn1').click(function () {
            $('.information').stop(true).animate({
                width: 860,
                height: 620,
                marginLeft: -430,
                marginTop: -310,
            }, function () {
                $('.shadow .information').stop(true).hide();
            }, function () {
                $('.information').stop(true).animate({
                    width: 480,
                    height: 280,
                    marginLeft: -240,
                    marginTop: -140,
                });
            });
            $('.shadow').stop(true).fadeOut(200);
//        重置首行的input框
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.data-info input').val('');

//      重置地区框
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.location .province').val('');
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.location .city,.area').hide();
//      重置详细信息
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.address-msg input').val('');
//        重置默认选项
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.sex .sex-btn .icon-circle').css({visibility: 'hidden'});
            $(this).parents('.layui-layer-btn').siblings('.data-block').find('.sex .sex-btn .default').show();
        });

        //    保存按钮
        $('.shadow .information .btn0-add').click(function () {
//        寻找到data-block
            var $block = $(this).parents('.layui-layer-btn').siblings('.data-block');
//        获取到首行input中的值
            var name = $($block).find('.data-info input').eq(0).val();
            var tal = $($block).find('.data-info input').eq(1).val();

//      获取默认框是否被选中
            var flag = $($block).find('.sex .sex-btn .default').is(':visible');
            var status = 0;
            if (!flag) {
                status = 1;
            }
//        获取所在地的值并放入信息表
            var province = $($block).find('.location .province').val();
            var city = $($block).find('.location .city').val();
            var area = $($block).find('.location .area').val();

//        获取详细地址信息
            var address = $($block).find('.address-msg input').val();

//        如果name 没有填写的提示信息
            var f = true;
            if (name == '') {
                f=false;
                $($block).find('.data-info .name em').show();
                $($block).find('.data-info .name .dp').css({
                    color: '#cc5252',
                });
                $($block).find('.data-info .name input').css({
                    borderBottom: '1px solid #cc5252',
                });
            } else {
                $($block).find('.data-info .name em').hide();
                $($block).find('.data-info .name .dp').css({
                    color: '#333',
                });
                $($block).find('.data-info .name input').css({
                    borderBottom: '1px solid #ddd',
                });
                $($block).find('.data-info .name em').hide();
                $($block).find('.data-info .name .dp').css({
                    color: '#333',
                });
                $($block).find('.data-info .name input').css({
                    borderBottom: '1px solid #ddd',
                });

                //        电话号码的提示信息
                if (tal == '') {
                    f=false;
                    $($block).find('.data-info .surname .error').show();
                    $($block).find('.data-info .surname .dp').css({
                        color: '#cc5252',
                    });
                    $($block).find('.data-info .surname input').css({
                        borderBottom: '1px solid #cc5252',
                    });
                } else {
                    var tal_reg = /^0?(13|14|15|17|18|19)[0-9]{9}$/;
                    var flag = tal_reg.test(tal);
                    if (!flag) {
                        f=false;
                        $($block).find('.data-info .surname .tal-error').show();
                        $($block).find('.data-info .surname .dp').css({
                            color: '#cc5252',
                        });
                        $($block).find('.data-info .surname input').css({
                            borderBottom: '1px solid #cc5252',
                        });
                    } else {
                        $($block).find('.data-info .surname em').hide();
                        $($block).find('.data-info .surname .dp').css({
                            color: '#333',
                        });
                        $($block).find('.data-info .surname input').css({
                            borderBottom: '1px solid #ddd',
                        });

//                如果地址没有填写的提示信息
                        if (province == '') {
                            f=false;
                            $($block).find('.location .dp').css({
                                color: '#cc5252',
                            });
                            $($block).find('.location .province ').css({
                                border: "1px solid #cc5252",
                            });
                        } else {

                            $($block).find('.location .dp').css({
                                color: '#333',
                            });
                            $($block).find('.location .province ').css({
                                border: "1px solid #ddd",
                            });
//                        没有详细地址的提示
                            if (address == '') {
                                f=false;
                                $($block).find('.address-msg em').show();
                                $($block).find('.address-msg .dp').css({
                                    color: '#cc5252',
                                });
                                $($block).find('.address-msg input').css({
                                    borderBottom: '1px solid #cc5252',
                                });
                            } else {
                                $($block).find('.address-msg  em').hide();
                                $($block).find('.address-msg  .dp').css({
                                    color: '#333',
                                });
                                $($block).find('.address-msg  input').css({
                                    borderBottom: '1px solid #ddd',
                                });
                                $('.shadow .information .btn1').click();
                            }
                        }
                    }
                }
            }
            if(f){
                var data = {
                    name:name,
                    phone:tal,
                    province:province,
                    city:city,
                    region:area,
                    detail_address:address,
                    send_status:status

                }
                const conf = app.conf.headers.Authorization;
                $.ajax({
                    url:"http://www.wbiao.com/user/address",
                    type:"post",
                    headers: {
                        "Authorization":conf
                    },
                    contentType: 'application/json',
                    dataType:"json",
                    data:JSON.stringify(data),
                    success:function(data){
                        var token = app.code;
                        window.location.href="http://www.wbiao.com/orderPage/shopping-order.html?Authorization="+token;
                    }
                })

            }
        });
        //  省市三级联动
        new PCAS("province3", "city3", "area3");

        $(function() {

            $('.order-floor .floor .cont-box li .on').click(function () {
                console.log(123)
            })
        });
    })

</script>
<script type="text/javascript">
    var app = new Vue({
        el: "#app",
        data: {
            user: null,
            flag: false,
            code : '',
            validateUrl: '',
            conf: null,
            carts:[],
            address:[],
            tradeCode:''
        },
        created() {
            const token = localStorage.getItem("token");
            if (token) {
                const config = {
                    headers :{
                        'Authorization' : 'Bearer '+token
                    }
                }
                const url = "http://www.wbiao.com/user/loginUserinfo";
                this.code = token;
                loginToken = token;
                this.validateUrl = url;
                this.conf = config;
                this.loadData(this.setData,this.code,this.validateUrl,this.conf);
            }
        },
        computed:{
            totalMoney(){
               return this.carts.reduce((c1, c2) => c1 + c2.money, 0);
            }
        },
        methods: {
            loadData(callBack,token,url,config) {
                getBookPromise()
                    .then(res => {
                        callBack(res.data); //callBack异步回调
                        const goods = JSON.parse(localStorage.getItem("buyGoods")) || null;
                        if(goods!=null){
                            this.carts.push(goods);
                            localStorage.removeItem("buyGoods");
                            axios.get("http://www.wbiao.com/orderPage/getCartInfo", this.conf)
                                .then(res => {
                                    this.address = res.data.data.address;
                                    this.tradeCode = res.data.data.tradeCode;
                                    this.address.forEach(function(obj){
                                        if(obj.send_status==0){
                                            obj.isActive = false;
                                        }else{
                                            obj.isActive = true;
                                        }
                                    });
                                })
                                .catch(res => {
                                })
                        }else{
                            axios.get("http://www.wbiao.com/orderPage/getCartInfo?flag=true", this.conf)
                                .then(res => {
                                    console.log(res);
                                    this.carts = res.data.data.carts;
                                    this.address = res.data.data.address;
                                    this.tradeCode = res.data.data.tradeCode;
                                    this.address.forEach(function(obj){
                                        if(obj.send_status==0){
                                            obj.isActive = false;
                                        }else{
                                            obj.isActive = true;
                                        }
                                    });
                                })
                                .catch(res => {
                                })
                        }
                    })
                    .catch(res => {
                        localStorage.removeItem("token");
                        console.log(res);
                    })
                function getBookPromise() {
                    return new Promise((resolve, reject) => {
                        axios.get(url, config)
                            .then(res => {
                                resolve(res)
                            })
                            .catch(res => {
                                reject(res)
                            })
                    })
                }
            },
            setData(data) { //对数据做一些处理
                this.user = data.data;
                this.flag = true;

            },
            logout() {
                // 退出
                localStorage.removeItem("token")
                window.location = 'http://www.wbiao.com/userPage/login.html';
            },
            active(index){
                if(this.$data.address[index].isActive){
                    return
                }
                for(var i = 0;i < this.$data.address.length;i++){
                    if(i==index){
                        this.$set(this.address[i], 'isActive', true);
                    }else{
                        this.$set(this.address[i], 'isActive', false);
                    }
                }
                this.$forceUpdate();
            },
            submit(){
                var ads = {};
                for(var i=0;i<this.address.length;i++){
                    if(this.address[i].isActive){
                        ads = this.address[i];
                    }
                }
                var ids = [];
                for(var i=0;i<this.carts.length;i++){
                    ids.push(this.carts[i].skuid);
                }
                const obj = {
                    receiver_name: ads.name,
                    receiver_phone: ads.phone,
                    receiver_province: ads.province,
                    receiver_city: ads.city,
                    receiver_region: ads.region,
                    receiver_detail_address: ads.detail_address,
                    skuids: ids
                }
                console.log(obj);
                if(this.code!=''){	//验证本地是否有token
                    //验证token是否有效
                    axios.get(this.validateUrl, this.conf)
                        .then(res => {	//如果token有效，则直接存入redis
                            const conf = this.conf.headers.Authorization;
                            $.ajax({
                                url:'http://www.wbiao.com/ord?tradeCode='+this.tradeCode,
                                type: 'post',
                                headers: {
                                    "Authorization":conf
                                },
                                contentType: 'application/json',
                                dataType: 'json',
                                data:JSON.stringify(obj),
                                success:function (res) {
                                    console.log(res);
                                    if(res.code==200){
                                        var id = res.data.order_id;
                                        var totalMoney = res.data.totalMoney;
                                        window.location.href="http://www.wbiao.com/orderPage/pay.html?id="+id+"&totalMoney="+totalMoney+"&Authorization="+conf;
                                    }else{
                                        alert("订单提交失败，请重新下单！");
                                    }
                                }
                            })
                        })
                        .catch(res => {
                            localStorage.removeItem("token");
                            window.location.href="http://www.wbiao.com/userPage?login.html";
                        })
                }else{
                    window.location.href="http://www.wbiao.com/userPage?login.html";
                }
            }
        }
    });

</script>
</body>
</html>